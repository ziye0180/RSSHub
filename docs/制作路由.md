---
title: "åˆ¶ä½œè·¯ç”± | RSSHub"
source: "https://docs.rsshub.app/zh/joinus/new-rss/start-code"
author:
published: 2024-04-24
created: 2025-11-04
description: "ä¸‡ç‰©çš†å¯ RSS ğŸ§¡"
tags:
  - "clippings"
---
## åˆ¶ä½œè·¯ç”±

## åˆ›å»ºå‘½åç©ºé—´

åˆ¶ä½œæ–°çš„ RSS è·¯ç”±çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºå‘½åç©ºé—´ã€‚å‘½åç©ºé—´åŸåˆ™ä¸Šåº”è¯¥ä¸ä½ åˆ¶ä½œ RSS æºçš„ä¸»è¦ç½‘ç«™çš„äºŒçº§åŸŸå **ç›¸åŒ** ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨ä¸º [https://github.com/DIYgod/RSSHub/issues](https://github.com/DIYgod/RSSHub/issues) åˆ¶ä½œ RSS æºï¼Œç¬¬äºŒçº§åŸŸåæ˜¯ `github` ã€‚å› æ­¤ï¼Œä½ åº”è¯¥åœ¨ `lib/routes` ä¸‹åˆ›å»ºåä¸º `github` çš„æ–‡ä»¶å¤¹ï¼Œä½œä¸ºä½ çš„ RSS è·¯ç”±çš„å‘½åç©ºé—´ã€‚

TIP

åœ¨åˆ›å»ºå‘½åç©ºé—´æ—¶ï¼Œé¿å…ä¸ºåŒä¸€å‘½åç©ºé—´çš„åˆ›å»ºå¤šä¸ªå˜ä½“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¸º `yahoo.co.jp` å’Œ `yahoo.com` åˆ¶ä½œ RSS æºï¼Œåˆ™åº”è¯¥ä½¿ç”¨å•ä¸ªå‘½åç©ºé—´ `yahoo` ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¤šä¸ªå‘½åç©ºé—´å¦‚ `yahoo-jp` ã€ `yahoojp` ã€ `yahoo.jp` ã€ `jp.yahoo` ã€ `yahoocojp` ç­‰ã€‚

ä¸€æ—¦ä½ ä¸º RSS è·¯ç”±åˆ›å»ºäº†å‘½åç©ºé—´ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åˆ›å»ºæ–‡ä»¶ `namespace.ts` æ¥å®šä¹‰å‘½åç©ºé—´ã€‚

æ–‡ä»¶åº”è¯¥é€šè¿‡ namespace è¿”å›ä¸€ä¸ªç¬¦åˆ Namespace ç±»å‹çš„å¯¹è±¡ã€‚Namespace çš„å®šä¹‰åœ¨ [/lib/types.ts](https://github.com/DIYgod/RSSHub/blob/master/lib/types.ts)

- nameï¼šä¾›äººç±»é˜…è¯»çš„å‘½åç©ºé—´çš„åç§°ï¼Œå®ƒä¼šè¢«ç”¨ä½œæ–‡æ¡£çš„æ ‡é¢˜
- urlï¼šå¯¹åº”ç½‘ç«™çš„ä¸åŒ…å« protocol çš„ç½‘å€
- descriptionï¼šå¯é€‰ï¼Œå¯¹ä½¿ç”¨æ­¤å‘½åç©ºé—´ç”¨æˆ·çš„æç¤ºå’Œé¢å¤–è¯´æ˜ï¼Œå®ƒä¼šè¢«æ’å…¥åˆ°æ–‡æ¡£ä¸­
- zh, zh-TW, ja: å¯é€‰ï¼Œè‹±æ–‡ä»¥å¤–çš„å¤šè¯­è¨€æ”¯æŒï¼Œå®ƒä¼šè¢«ç”¨ä½œç”Ÿæˆå¤šè¯­è¨€æ–‡æ¡£

ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­æ˜¯ï¼š

## åˆ›å»ºè·¯ç”±

ä¸€æ—¦ä½ ä¸ºè·¯ç”±åˆ›å»ºäº†å‘½åç©ºé—´ï¼Œä¸‹ä¸€æ­¥åˆ›å»ºä¸€ä¸ªè·¯ç”±æ–‡ä»¶æ³¨å†Œè·¯ç”±ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¸º [GitHub ä»“åº“ Issues](https://docs.rsshub.app/zh/routes/programming#repo-issues) åˆ¶ä½œ RSS æºï¼Œå¹¶ä¸”å‡è®¾ä½ å¸Œæœ›ç”¨æˆ·è¾“å…¥ GitHub ç”¨æˆ·åå’Œä»“åº“åï¼Œå¦‚æœä»–ä»¬æ²¡æœ‰è¾“å…¥ä»“åº“åï¼Œåˆ™è¿”å›åˆ° `RSSHub` ï¼Œä½ å¯ä»¥åœ¨ `/lib/routes/github/issue.ts` ä¸­æ³¨å†Œä½ çš„æ–° RSS è·¯ç”±ï¼Œæ–‡ä»¶éœ€è¦é€šè¿‡ route è¿”å›ä¸€ä¸ªç¬¦åˆ Route ç±»å‹çš„å¯¹è±¡ã€‚Route çš„å®šä¹‰åœ¨ [/lib/types.ts](https://github.com/DIYgod/RSSHub/blob/master/lib/types.ts)

- path: è·¯ç”±è·¯å¾„ï¼Œä½¿ç”¨ [Hono è·¯ç”±](https://hono.dev/api/routing) è¯­æ³•
- name: ä¾›äººç±»é˜…è¯»çš„è·¯ç”±åç§°ï¼Œå®ƒä¼šè¢«ç”¨ä½œæ–‡æ¡£çš„æ ‡é¢˜
- url: å¯¹åº”ç½‘ç«™çš„ä¸åŒ…å« protocol çš„ç½‘å€
- maintainers: è´Ÿè´£ç»´æŠ¤æ­¤è·¯ç”±çš„äººå‘˜çš„ GitHub handle
- example: è·¯ç”±çš„ä¸€ä¸ªç¤ºä¾‹ URL
- parameters: è·¯ç”±çš„å‚æ•°è¯´æ˜
- description: å¯é€‰ï¼Œå¯¹ä½¿ç”¨æ­¤è·¯ç”±ç”¨æˆ·çš„æç¤ºå’Œé¢å¤–è¯´æ˜ï¼Œå®ƒä¼šè¢«æ’å…¥åˆ°æ–‡æ¡£ä¸­
- categories: è·¯ç”±çš„åˆ†ç±»ï¼Œå®ƒä¼šè¢«å†™å…¥åˆ°å¯¹åº”åˆ†ç±»çš„æ–‡æ¡£ä¸­
- features: è·¯ç”±çš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚ä¾èµ–å“ªäº›é…ç½®é¡¹ï¼Œæ˜¯å¦åçˆ¬ä¸¥æ ¼ï¼Œæ˜¯å¦æ”¯æŒæŸç§åŠŸèƒ½ç­‰
- radar: å¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨ä½¿ç”¨ [RSSHub Radar](https://github.com/DIYgod/RSSHub-Radar) æˆ–å…¶ä»–å…¼å®¹å…¶æ ¼å¼çš„è½¯ä»¶æ—¶è®¢é˜…ä½ çš„æ–° RSS è·¯ç”±ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„éƒ¨åˆ†æ›´å¤šä»‹ç»
- handler: è·¯ç”±çš„å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„éƒ¨åˆ†æ›´å¤šä»‹ç»

ä¸€ä¸ªå®Œæ•´ä¾‹å­æ˜¯ï¼š

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ `issue` æ˜¯ä¸€ä¸ªç²¾ç¡®åŒ¹é…ï¼Œ`:user` æ˜¯ä¸€ä¸ªå¿…éœ€å‚æ•°ï¼Œ`:repo?` æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚`?` åœ¨ `:repo` ä¹‹åè¡¨ç¤ºè¯¥å‚æ•°æ˜¯å¯é€‰çš„

## ç¼–å†™é›·è¾¾è§„åˆ™

åœ¨ [åˆ›å»ºè·¯ç”±](https://docs.rsshub.app/zh/joinus/new-rss/#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1) ä¸­ï¼Œæˆ‘ä»¬æåˆ°è·¯ç”±ä¿¡æ¯åŒ…å«ä¸€ä¸ª radar å­—æ®µæ¥è®°å½• RSSHub Radar è§„åˆ™ã€‚

ä¸‹é¢ä»¥ `GitHub ä»“åº“ Issues` çš„ RSS è§„åˆ™ä¸ºä¾‹ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

### source

source æ˜¯ *å¯é€‰* å­—æ®µï¼Œåº”æŒ‡å®šä¸åŒ…å«åè®®åçš„ URL è·¯å¾„ã€‚å¦‚æœä¸æƒ³åŒ¹é…ä»»ä½• URL è·¯å¾„ï¼Œè¯·å°†å…¶ç•™ç©ºã€‚å®ƒåªä¼šå‡ºç°åœ¨ RSSHub Radar æµè§ˆå™¨æ‰©å±•ç¨‹åºçš„ `é€‚ç”¨äºå½“å‰ç½‘ç«™çš„ RSSHub` é€‰é¡¹ä¸­ã€‚

source åº”ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `GitHub ä»“åº“ Issues` çš„ source æ˜¯ `github.com/:user/:repo` ï¼Œåˆ™æ„å‘³ç€å½“ä½ è®¿é—® `https://github.com/DIYgod/RSSHub` æ—¶å°†åŒ¹é…åˆ° `github.com/:user/:repo` ï¼Œæ­¤æ—¶è¿”å›çš„ç»“æœ params å°†æ˜¯ï¼š `{user: 'DIYgod', repo: 'RSSHub'}` ã€‚æµè§ˆå™¨æ‰©å±•ç¨‹åºä½¿ç”¨è¿™äº›å‚æ•°æ ¹æ® target å­—æ®µå»ºç«‹ RSSHub è®¢é˜…åœ°å€ã€‚

### target

ç›®æ ‡æ˜¯ **å¯é€‰** å­—æ®µï¼Œå¹¶ç”¨äºç”Ÿæˆ RSSHub è®¢é˜…åœ°å€ï¼Œå®ƒå¯ä»¥æ¥å—å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ã€‚å¦‚æœä½ ä¸æƒ³å»ºç«‹ RSSHub è®¢é˜…åœ°å€ï¼Œå¯ä»¥å°†æ­¤å­—æ®µç•™ç©ºã€‚

ä»¥ `GitHub ä»“åº“ Issues` ä¸ºä¾‹ï¼Œåœ¨ RSSHub æ–‡æ¡£ä¸­ç›¸åº”çš„è·¯ç”±ä¸º `/github/issue/:user/:repo` ã€‚

åœ¨å°† source è·¯å¾„ä¸­çš„ `user` åŒ¹é…ä¸º `DIYgod` ï¼Œ `repo` åŒ¹é…ä¸º `RSSHub` åï¼ŒRSSHub è·¯ç”±ä¸­çš„ `:user` å°†è¢«æ›¿æ¢ä¸º `DIYgod` ï¼Œ`:repo` å°†è¢«æ›¿æ¢ä¸º `RSSHub` ï¼Œç»“æœä¸º `/github/issue/DIYgod/RSSHub` ã€‚

### è°ƒè¯•

å¦‚æœéœ€è¦è°ƒè¯•æ–°è§„åˆ™çš„ç»“æœï¼Œå»ºè®®ä½ å®‰è£…æµè§ˆå™¨æ‰©å±•ç¨‹åºã€‚ä½ å¯ä»¥åœ¨ [RSSHub Radar README](https://github.com/DIYgod/RSSHub-Radar?tab=readme-ov-file#install) ä¸‹è½½é€‚åˆä½ æµè§ˆå™¨çš„æ‰©å±•ç¨‹åºã€‚

ç„¶ååœ¨æ‰©å±•ç¨‹åºçš„è®¾ç½®é¡µï¼ŒæŠŠ `RSSHub instance` è®¾ç½®ä¸ºä½ æœ¬åœ°çš„ `http://localhost:1200` ï¼Œç„¶åç‚¹å‡» `Update Now` ï¼Œæ–°è§„åˆ™å°±ä¼šç”Ÿæ•ˆã€‚

## ç¼–å†™è·¯ç”±å¤„ç†å‡½æ•°

å¤„ç†å‡½æ•°ä¼šè¢«ä¼ å…¥ä¸€ä¸ªå‚æ•° ctxï¼Œå‡½æ•°ç»“æŸåéœ€è¦è¿”å›ä¸€ä¸ªåŒ…å« RSS æ‰€éœ€ä¿¡æ¯çš„å¯¹è±¡ã€‚ctx å¯ä»¥ä½¿ç”¨çš„ API å¯ä»¥åœ¨ [Hono context æ–‡æ¡£](https://hono.dev/api/context) ä¸­æŸ¥çœ‹ï¼›è¿”å›å€¼çš„ç±»å‹åœ¨è¿™é‡Œå®šä¹‰ï¼š [/lib/types.ts](https://github.com/DIYgod/RSSHub/blob/master/lib/types.ts)

æˆ‘ä»¬æœ‰ä¸‰ç§å¸¸è§çš„æ•°æ®è·å–æ–¹æ³•ï¼š

1. [é€šè¿‡ API](https://docs.rsshub.app/zh/joinus/new-rss/#%E9%80%9A%E8%BF%87-api)
2. [é€šè¿‡ HTML](https://docs.rsshub.app/zh/joinus/new-rss/#%E9%80%9A%E8%BF%87-html)
3. [ä½¿ç”¨ Puppeteer](https://docs.rsshub.app/zh/joinus/new-rss/#%E4%BD%BF%E7%94%A8-puppeteer)

ä¸‹é¢æˆ‘ä»¬ç»§ç»­ä»¥ GitHub ä»“åº“ Issues ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ç¼–å†™è¿™ä¸‰ç§å¸¸è§çš„è·¯ç”±å¤„ç†å‡½æ•°ã€‚

## é€šè¿‡ API

ä½ åº”è¯¥ä¼˜å…ˆé€‰æ‹©ä½¿ç”¨ API è·å–æ•°æ®ï¼Œå› ä¸º API é€šå¸¸æ¯” HTML æ›´å®¹æ˜“è§£æå’Œæ›´ç¨³å®šã€‚

### æŸ¥çœ‹ API æ–‡æ¡£

ä¸åŒçš„ç«™ç‚¹æœ‰ä¸åŒçš„ APIã€‚ä½ å¯ä»¥æŸ¥çœ‹è¦ä¸ºå…¶åˆ¶ä½œ RSS æºçš„ç«™ç‚¹çš„ API æ–‡æ¡£ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [GitHub Issues API](https://docs.github.com/zh/rest/issues/issues#list-repository-issues) ã€‚

ä½†æ›´å¤šæƒ…å†µæ˜¯ç½‘ç«™æ²¡æœ‰æä¾›å¼€æ”¾ APIï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·æˆ–è€…æŠ“åŒ…å·¥å…·æ¥æŸ¥çœ‹ç«™ç‚¹å‘èµ·çš„è¯·æ±‚ã€‚

### åŸºæœ¬ä»£ç 

ä»¥ä¸‹æ˜¯è®©ä½ å¼€å§‹çš„åŸºæœ¬ä»£ç ï¼š

### è·å–ç”¨æˆ·è¾“å…¥

æˆ‘ä»¬é¦–å…ˆéœ€è¦ä»ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„ä¸­è·å– GitHub ç”¨æˆ·åå’Œä»“åº“åç§°ã€‚å¦‚æœè¯·æ±‚ä¸­æœªæä¾›ä»“åº“åç§°ï¼Œåˆ™åº”é»˜è®¤ä¸º `RSSHub` ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å®ç°ï¼š

### ä» API è·å–æ•°æ®

åœ¨è·å–ç”¨æˆ·è¾“å…¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒå‘ API å‘é€è¯·æ±‚ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨ `@/utils/ofetch` ä¸­çš„ `ofetch` ï¼ˆä¸€ä¸ªè‡ªè®¢çš„ [ofetch](https://github.com/unjs/ofetch) åŒ…è£…å‡½æ•°ï¼‰å‘é€ HTTP è¯·æ±‚ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [ofetch æ–‡æ¡£](https://github.com/unjs/ofetch) ã€‚

### æ„é€ å’Œè¿”å›ç»“æœ

ä¸€æ—¦æˆ‘ä»¬ä» API è·å–åˆ°æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å¤„ç†å®ƒä»¥ç”Ÿæˆç¬¦åˆ RSS è§„èŒƒçš„ RSS æºã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æå–æºæ ‡é¢˜ã€æºé“¾æ¥ã€æ–‡ç« æ ‡é¢˜ã€æ–‡ç« é“¾æ¥ã€æ–‡ç« æ­£æ–‡å’Œæ–‡ç« å‘å¸ƒæ—¥æœŸã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸å…³æ•°æ®é€šè¿‡ handler è¿”å›ï¼ŒRSSHub çš„ä¸­é—´ä»¶å°†å¤„ç†å…¶ä½™éƒ¨åˆ†ã€‚

ä»¥ä¸‹æ˜¯åº”æœ‰çš„æœ€ç»ˆä»£ç ï¼š

```ts
tsimport { Route } from '@/types';

import ofetch from '@/utils/ofetch'; // ç»Ÿä¸€ä½¿ç”¨çš„è¯·æ±‚åº“

import { parseDate } from '@/utils/parse-date'; // è§£ææ—¥æœŸçš„å·¥å…·å‡½æ•°

export const route: Route = {

    // åœ¨æ­¤å¤„ç¼–å†™å‰æ–‡ä»‹ç»çš„è·¯ç”±ä¿¡æ¯

    handler: (ctx) => {

        const { user, repo = 'RSSHub' } = ctx.req.param();

        const data = await ofetch(\`https://api.github.com/repos/${user}/${repo}/issues\`, {

            headers: {

                accept: 'application/vnd.github.html+json',

            },

        });

        // ä» API å“åº”ä¸­æå–ç›¸å…³æ•°æ®

        const items = data.map((item) => ({

            // æ–‡ç« æ ‡é¢˜

            title: item.title,

            // æ–‡ç« é“¾æ¥

            link: item.html_url,

            // æ–‡ç« æ­£æ–‡

            description: item.body_html,

            // æ–‡ç« å‘å¸ƒæ—¥æœŸ

            pubDate: parseDate(item.created_at),

            // å¦‚æœæœ‰çš„è¯ï¼Œæ–‡ç« ä½œè€…

            author: item.user.login,

            // å¦‚æœæœ‰çš„è¯ï¼Œæ–‡ç« åˆ†ç±»

            category: item.labels.map((label) => label.name),

        }));

        return {

            // æºæ ‡é¢˜

            title: \`${user}/${repo} issues\`,

            // æºé“¾æ¥

            link: \`https://github.com/${user}/${repo}/issues\`,

            // æºæ–‡ç« 

            item: items,

        };

    },

};
```

## é€šè¿‡ HTML

å¦‚æœæºç«™æ²¡æœ‰ä½¿ç”¨ API æ¥è¿”å›æ•°æ®ï¼Œè€Œæ˜¯æŠŠæ•°æ®ç›´æ¥æ¸²æŸ“åˆ°äº† HTML ä¸­è¿”å›ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§è·å–æ–¹å¼ã€‚

### åŸºæœ¬ä»£ç 

ä»¥ä¸‹æ˜¯è®©ä½ å¼€å§‹çš„åŸºæœ¬ä»£ç ï¼š

### è·å–ç”¨æˆ·è¾“å…¥

æˆ‘ä»¬é¦–å…ˆéœ€è¦ä»ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„ä¸­è·å– GitHub ç”¨æˆ·åå’Œä»“åº“åç§°ã€‚å¦‚æœè¯·æ±‚ä¸­æœªæä¾›ä»“åº“åç§°ï¼Œåˆ™åº”é»˜è®¤ä¸º `RSSHub` ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å®ç°ï¼š

### ä» HTML è·å–æ•°æ®

åœ¨è·å–äº†ç”¨æˆ·è¾“å…¥ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å‘ç½‘é¡µå‘èµ·è¯·æ±‚ï¼Œä»¥æ£€ç´¢æ‰€éœ€çš„ä¿¡æ¯ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨ `@/utils/ofetch` ä¸­çš„ `ofetch` ï¼ˆä¸€ä¸ªè‡ªè®¢çš„ [ofetch](https://github.com/unjs/ofetch) åŒ…è£…å‡½æ•°ï¼‰å‘é€ HTTP è¯·æ±‚ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [ofetch æ–‡æ¡£](https://github.com/unjs/ofetch) ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‘ API å‘é€ HTTP GET è¯·æ±‚ï¼Œå¹¶å°† HTML å“åº”åŠ è½½åˆ° Cheerio ä¸­ï¼ŒCheerio æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬è§£æå’Œæ“ä½œ HTML çš„åº“ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Cheerio é€‰æ‹©å™¨é€‰æ‹©ç›¸å…³çš„ HTML å…ƒç´ ï¼Œè§£ææˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ•°ç»„ã€‚

### æ„é€ å’Œè¿”å›ç»“æœ

ä¸€æ—¦æˆ‘ä»¬ä» API è·å–åˆ°æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å¤„ç†å®ƒä»¥ç”Ÿæˆç¬¦åˆ RSS è§„èŒƒçš„ RSS æºã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æå–æºæ ‡é¢˜ã€æºé“¾æ¥ã€æ–‡ç« æ ‡é¢˜ã€æ–‡ç« é“¾æ¥ã€æ–‡ç« æ­£æ–‡å’Œæ–‡ç« å‘å¸ƒæ—¥æœŸã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸å…³æ•°æ®é€šè¿‡ handler è¿”å›ï¼ŒRSSHub çš„ä¸­é—´ä»¶å°†å¤„ç†å…¶ä½™éƒ¨åˆ†ã€‚

ä»¥ä¸‹æ˜¯åº”æœ‰çš„æœ€ç»ˆä»£ç ï¼š

```ts
tsimport { Route } from '@/types';

import ofetch from '@/utils/ofetch';

import { load } from 'cheerio';

import { parseDate } from '@/utils/parse-date';

export const route: Route = {

    // åœ¨æ­¤å¤„ç¼–å†™å‰æ–‡ä»‹ç»çš„è·¯ç”±ä¿¡æ¯

    handler: (ctx) => {

        const { user, repo = 'RSSHub' } = ctx.req.param();

        const response = await ofetch(\`https://github.com/${user}/${repo}/issues\`);

        const $ = load(response);

        const items = $('div.js-navigation-container .flex-auto')

            .toArray()

            .map((item) => {

                item = $(item);

                const a = item.find('a').first();

                return {

                    title: a.text(),

                    link: \`https://github.com${a.attr('href')}\`,

                    pubDate: parseDate(item.find('relative-time').attr('datetime')),

                    author: item.find('.opened-by a').text(),

                    category: item

                        .find('a[id^=label]')

                        .toArray()

                        .map((item) => $(item).text()),

                };

            });

        return {

            // æºæ ‡é¢˜

            title: \`${user}/${repo} issues\`,

            // æºé“¾æ¥

            link: \`https://github.com/${user}/${repo}/issues\`,

            // æºæ–‡ç« 

            item: items,

        };

    },

};
```

### è·å–å…¨æ–‡

ä»åˆ—è¡¨ HTML ä¸­è·å–çš„æ•°æ®é€šå¸¸ä¸ä¼šåŒ…å«å®Œæ•´çš„æ–‡ç« ã€‚ä¸ºäº†æä¾›æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚æ¯ä¸ªè¯¦æƒ…é¡µæ¥åœ¨å±•ç¤ºå®Œæ•´çš„æ–‡ç« ï¼Œä¾‹å¦‚æ¯ä¸ª GitHub Issue çš„æ­£æ–‡ã€‚

åœ¨å…ˆå‰çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä»…éœ€å‘ API å‘é€ä¸€ä¸ª HTTP è¯·æ±‚å³å¯è·å¾—æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚ç„¶è€Œï¼Œåœ¨æ­¤éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å‘é€ `1 + n` ä¸ª HTTP è¯·æ±‚ï¼Œå…¶ä¸­ `n` æ˜¯ä»ç¬¬ä¸€ä¸ªè¯·æ±‚è·å–çš„æ–‡ç« åˆ—è¡¨ä¸­çš„æ•°é‡ã€‚

éƒ¨åˆ†ç½‘ç«™å¯èƒ½ä¸å–œæ¬¢åœ¨çŸ­æ—¶é—´å†…æ¥æ”¶å¤§é‡è¯·æ±‚ï¼Œå¹¶è¿”å›ç±»ä¼¼äºâ€œ429 Too Many Requestsâ€çš„é”™è¯¯ï¼Œåˆç† [ä½¿ç”¨ç¼“å­˜](https://docs.rsshub.app/zh/joinus/advanced/use-cache) å¯ä»¥æå¤§å‡å°‘è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚

ä»¥ä¸‹æ˜¯æ›´æ–°åçš„ä»£ç ï¼š

```ts
tsimport ofetch from '@/utils/ofetch';

import { load } from 'cheerio';

import { parseDate } from '@/utils/parse-date';

export const route: Route = {

    // åœ¨æ­¤å¤„ç¼–å†™å‰æ–‡ä»‹ç»çš„è·¯ç”±ä¿¡æ¯

    handler: (ctx) => {

        const baseUrl = 'https://github.com';

        const { user, repo = 'RSSHub' } = ctx.req.param();

        const response = await ofetch(\`${baseUrl}/${user}/${repo}/issues\`);

        const $ = load(response);

        const list = $('div.js-navigation-container .flex-auto')

            .toArray()

            .map((item) => {

                item = $(item);

                const a = item.find('a').first();

                return {

                    title: a.text(),

                    link: \`${baseUrl}${a.attr('href')}\`,

                    pubDate: parseDate(item.find('relative-time').attr('datetime')),

                    author: item.find('.opened-by a').text(),

                    category: item

                        .find('a[id^=label]')

                        .toArray()

                        .map((item) => $(item).text()),

                };

            });

        const items = await Promise.all(

            list.map((item) =>

                cache.tryGet(item.link, async () => {

                    const response = await ofetch(item.link);

                    const $ = load(response);

                    // é€‰æ‹©ç±»åä¸ºâ€œcomment-bodyâ€çš„ç¬¬ä¸€ä¸ªå…ƒç´ 

                    item.description = $('.comment-body').first().html();

                    // ä¸Šé¢æ¯ä¸ªåˆ—è¡¨é¡¹çš„æ¯ä¸ªå±æ€§éƒ½åœ¨æ­¤é‡ç”¨ï¼Œ

                    // å¹¶å¢åŠ äº†ä¸€ä¸ªæ–°å±æ€§â€œdescriptionâ€

                    return item;

                })

            )

        );

        return {

            title: \`${user}/${repo} issues\`,

            link: \`https://github.com/${user}/${repo}/issues\`,

            item: items,

        };

    }

};
```

## ä½¿ç”¨ Puppeteer

å°‘éƒ¨åˆ†ç½‘ç«™ä½¿ç”¨äº†æä¸ºä¸¥æ ¼çš„åçˆ¬ç­–ç•¥æˆ–è€…å¤æ‚çš„åŠ å¯†ç®—æ³•æ¥é˜»æ­¢è·å–æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ Puppeteer æ¥æ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸ºï¼Œä»¥è·å–æ•°æ®ã€‚

å»ºè®®ä½ å…ˆé˜…è¯»å‰é¢ä¸¤ç§æ–¹æ³•ï¼Œå› ä¸ºæœ¬èŠ‚æ˜¯å‰ä¸€èŠ‚çš„æ‰©å±•ï¼Œä¸ä¼šè§£é‡Šä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚

### å°† ofetch æ›¿æ¢ä¸º puppeteer

ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `puppeteer` ä»£æ›¿ `ofetch` æ¥ä»ç½‘é¡µè·å–æ•°æ®ã€‚

```ts
tsimport { Route } from '@/types';

import { load } from 'cheerio';

import { parseDate } from '@/utils/parse-date';

import logger from '@/utils/logger';

import puppeteer from '@/utils/puppeteer';

export const route: Route = {

    // ...

    handler: (ctx) => {

        const baseUrl = 'https://github.com';

        const { user, repo = 'RSSHub' } = ctx.req.param();

        // å¯¼å…¥ puppeteer å·¥å…·ç±»å¹¶åˆå§‹åŒ–æµè§ˆå™¨å®ä¾‹

        const browser = await puppeteer();

        // æ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µ

        const page = await browser.newPage();

        // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚

        await page.setRequestInterception(true);

        // ä»…å…è®¸æŸäº›ç±»å‹çš„è¯·æ±‚

        page.on('request', (request) => {

            // åœ¨è¿™æ¬¡ä¾‹å­ï¼Œæˆ‘ä»¬åªå…è®¸ HTML è¯·æ±‚

            request.resourceType() === 'document' ? request.continue() : request.abort();

        });

        // è®¿é—®ç›®æ ‡é“¾æ¥

        const link = \`${baseUrl}/${user}/${repo}/issues\`;

        // ofetch è¯·æ±‚ä¼šè¢«è‡ªåŠ¨è®°å½•ï¼Œ

        // ä½† puppeteer è¯·æ±‚ä¸ä¼š

        // æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®°å½•å®ƒä»¬

        logger.http(\`Requesting ${link}\`);

        await page.goto(link, {

            // æŒ‡å®šé¡µé¢ç­‰å¾…è½½å…¥çš„æ—¶é—´

            waitUntil: 'domcontentloaded',

        });

        // è·å–é¡µé¢çš„ HTML å†…å®¹

        const response = await page.content();

        // å…³é—­æ ‡ç­¾é¡µ

        page.close();

        const $ = load(response);

        // const item = ...;

        // ä¸è¦å¿˜è®°å…³é—­æµè§ˆå™¨å®ä¾‹

        browser.close();

        return {

            // åœ¨æ­¤å¤„è¾“å‡ºä½ çš„ RSS

        };

    },

}
```

### è·å–å…¨æ–‡

ä½¿ç”¨æµè§ˆå™¨æ–°æ ‡ç­¾é¡µè·å–æ¯ä¸ª GitHub Issue çš„æ­£æ–‡ï¼Œç±»ä¼¼äº [ä¸Šä¸€èŠ‚](https://docs.rsshub.app/zh/joinus/new-rss/#%E8%8E%B7%E5%8F%96%E5%85%A8%E6%96%87) ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š

```ts
tsimport { Route } from '@/types';

import { load } from 'cheerio';

import { parseDate } from '@/utils/parse-date';

import logger from '@/utils/logger';

import puppeteer from '@/utils/puppeteer';

export const route: Route = {

    // ...

    handler: (ctx) => {

        const baseUrl = 'https://github.com';

        const { user, repo = 'RSSHub' } = ctx.req.param();

        const browser = await puppeteer();

        const page = await browser.newPage();

        await page.setRequestInterception(true);

        page.on('request', (request) => {

            request.resourceType() === 'document' ? request.continue() : request.abort();

        });

        const link = \`${baseUrl}/${user}/${repo}/issues\`;

        logger.http(\`Requesting ${link}\`);

        await page.goto(link, {

            waitUntil: 'domcontentloaded',

        });

        const response = await page.content();

        page.close();

        const $ = load(response);

        const list = $('div.js-navigation-container .flex-auto')

            .toArray()

            .map((item) => {

                item = $(item);

                const a = item.find('a').first();

                return {

                    title: a.text(),

                    link: \`${baseUrl}${a.attr('href')}\`,

                    pubDate: parseDate(item.find('relative-time').attr('datetime')),

                    author: item.find('.opened-by a').text(),

                    category: item

                        .find('a[id^=label]')

                        .toArray()

                        .map((item) => $(item).text()),

                };

            });

        const items = await Promise.all(

            list.map((item) =>

                cache.tryGet(item.link, async () => {

                    // highlight-start

                    // é‡ç”¨æµè§ˆå™¨å®ä¾‹å¹¶æ‰“å¼€æ–°æ ‡ç­¾é¡µ

                    const page = await browser.newPage();

                    // è®¾ç½®è¯·æ±‚æ‹¦æˆªï¼Œä»…å…è®¸ HTML è¯·æ±‚

                    await page.setRequestInterception(true);

                    page.on('request', (request) => {

                        request.resourceType() === 'document' ? request.continue() : request.abort();

                    });

                    logger.http(\`Requesting ${item.link}\`);

                    await page.goto(item.link, {

                        waitUntil: 'domcontentloaded',

                    });

                    const response = await page.content();

                    // è·å– HTML å†…å®¹åå…³é—­æ ‡ç­¾é¡µ

                    page.close();

                    // highlight-end

                    const $ = load(response);

                    item.description = $('.comment-body').first().html();

                    return item;

                })

            )

        );

        // æ‰€æœ‰è¯·æ±‚å®Œæˆåå…³é—­æµè§ˆå™¨å®ä¾‹

        browser.close();

        return {

            title: \`${user}/${repo} issues\`,

            link: \`https://github.com/${user}/${repo}/issues\`,

            item: items,

        };

    },

};
```

### é¢å¤–èµ„æº

è¿™é‡Œæœ‰ä¸€äº›ä½ å¯ä»¥ä½¿ç”¨çš„èµ„æºæ¥äº†è§£ puppeteerï¼š

- [puppeteer&#39;s å½“å‰æ–‡æ¡£](https://pptr.dev/)
- [puppeteer&#39;s éå®˜æ–¹ä¸­æ–‡æ–‡æ¡£](https://zhaoqize.github.io/puppeteer-api-zh_CN/)

#### æ‹¦æˆªè¯·æ±‚

åœ¨çˆ¬å–ç½‘é¡µæ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä½ ä¸éœ€è¦çš„å›¾åƒã€å­—ä½“å’Œå…¶ä»–èµ„æºã€‚è¿™äº›èµ„æºä¼šå‡æ…¢é¡µé¢åŠ è½½é€Ÿåº¦å¹¶æ¶ˆè€—å®è´µçš„ CPU å’Œå†…å­˜èµ„æºã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥åœ¨ puppeteer ä¸­å¯ç”¨è¯·æ±‚æ‹¦æˆªã€‚

è¿™æ˜¯å¦‚ä½•å®ç°çš„ï¼š

ä½ å¯ä»¥åœ¨ [è¿™é‡Œ](https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-ResourceType) æ‰¾åˆ° `request.resourceType()` çš„æ‰€æœ‰å¯èƒ½å€¼ã€‚åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™äº›å€¼æ—¶ï¼Œè¯·ç¡®ä¿ä½¿ç”¨ **å°å†™** å­—æ¯ã€‚

#### Wait Until

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½ å°†çœ‹åˆ°åœ¨ `page.goto()` å‡½æ•°ä¸­ä½¿ç”¨äº† `waitUntil: 'domcontentloaded'` ã€‚è¿™æ˜¯ puppeteer çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå‘Šè¯‰å®ƒåœ¨ä½•æ—¶è®¤ä¸ºå¯¼èˆªæˆåŠŸã€‚ä½ å¯ä»¥åœ¨ [è¿™é‡Œ](https://pptr.dev/api/puppeteer.page.goto/#remarks) æ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„å€¼åŠå…¶å«ä¹‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ `domcontentloaded` çš„ç­‰å¾…æ—¶é—´è¾ƒçŸ­ï¼Œè€Œ `networkidle0` å¯èƒ½ä¸é€‚ç”¨äºå§‹ç»ˆå‘é€åå°é¥æµ‹æˆ–è·å–æ•°æ®çš„ç½‘ç«™ã€‚

æ­¤å¤–ï¼Œé‡è¦çš„æ˜¯é¿å…ç­‰å¾…ç‰¹å®šçš„è¶…æ—¶æ—¶é—´ï¼Œè€Œæ˜¯ç­‰å¾…é€‰æ‹©å™¨å‡ºç°ã€‚ç­‰å¾…è¶…æ—¶æ˜¯ä¸å‡†ç¡®çš„ï¼Œå› ä¸ºå®ƒå–å†³äº puppeteer å®ä¾‹çš„è´Ÿè½½æƒ…å†µã€‚
